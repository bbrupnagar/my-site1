<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Digital Teacher Diary</title>

<!-- PDF LIBS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family: Arial;
  background: #fff8c6;
  margin:0;
  padding:20px;
}
.wrap{
  max-width:1100px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 8px 25px #0002;
}
h1{
  margin:0;
  text-align:center;
  color:#333;
}
.subtitle{
  text-align:center;
  font-weight:700;
  margin-top:4px;
  font-size:16px;
}
label{font-weight:700;display:block;margin-bottom:4px;}
input,select,textarea{
  width:100%;
  padding:8px;
  border-radius:6px;
  border:1px solid #ccc;
}
textarea{height:70px;}
.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:12px;
}
.col{flex:1;min-width:220px;}

button{
  padding:10px 14px;
  border:none;
  background:#004aad;
  color:#fff;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
}
button.secondary{background:#00a86b;}
button.danger{background:#c90000;}

.table-wrap{
  margin-top:20px;
  overflow-x:auto;
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
}
th{
  background:#ffeeb3;
}
#printArea{
  display:none;
  padding:20px;
}
.diary-title{
  text-align:center;
  font-size:28px;
  font-weight:800;
}

/* Popup */
#datePopup{
  position:fixed;
  top:0;left:0;width:100%;height:100%;
  background:#0005;
  display:none;
  align-items:center;
  justify-content:center;
}
#datePopup .box{
  background:#fff;
  padding:20px;
  border-radius:10px;
  min-width:300px;
}
</style>
</head>

<body>

<div class="wrap">

<h1>Digital Teacher Diary</h1>
<div class="subtitle">Created By Prabhjeet Singh</div>

<!-- Teacher Info -->
<div class="row">
  <div class="col">
    <label>Teacher's Name</label>
    <input id="tname" type="text" placeholder="Enter your name">
  </div>
  <div class="col">
    <label>Designation</label>
    <input id="tdesign" type="text" placeholder="e.g., Science Teacher">
  </div>
  <div class="col">
    <label>School Name</label>
    <input id="tschool" type="text">
  </div>
</div>

<hr style="margin:15px 0;">

<!-- Daily Entry -->
<div class="row">
  <div class="col">
    <label>Select Date</label>
    <input id="date" type="date">
  </div>
  <div class="col">
    <label>Class</label>
    <select id="classSel">
      <option value="">Select</option>
      <option>6</option><option>7</option><option>8</option>
      <option>9</option><option>10</option><option>11</option><option>12</option>
    </select>
  </div>
  <div class="col">
    <label>Subject</label>
    <input id="subject" type="text" placeholder="Science, Math, etc.">
  </div>
  <div class="col">
    <label>Period No.</label>
    <select id="period">
      <option value="">Select</option>
      <option>1</option>
      <option>2</option>
      <option>3</option>
      <option>4</option>
      <option>5</option>
      <option>6</option>
      <option>7</option>
      <option>8</option>
    </select>
  </div>
</div>

<div class="row">
  <div class="col">
    <label>Topic Taught</label>
    <textarea id="topic"></textarea>
  </div>
  <div class="col">
    <label>Home Assignment</label>
    <textarea id="home"></textarea>
  </div>
</div>

<div class="row" style="justify-content:flex-end;">
  <button id="saveBtn">ðŸ’¾ Save Entry</button>
  <button id="printBtn" class="secondary">ðŸ–¨ Print</button>
  <button id="pdfBtn" class="secondary">ðŸ“„ PDF</button>
</div>

<!-- Display Records -->
<div class="table-wrap">
  <h3>Saved Diary Entries</h3>
  <table id="diaryTable">
    <thead>
      <tr>
        <th>Date</th><th>Class</th><th>Subject</th><th>Period</th>
        <th>Topic Taught</th><th>Home Assignment</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

</div>

<!-- PRINT AREA -->
<div id="printArea">
  <div class="diary-title">Digital Teacher Diary</div>
  <div style="text-align:center;font-weight:700;margin-bottom:10px;">
    Created By Prabhjeet Singh
  </div>
  <div id="printTeacherInfo" style="font-weight:700;margin-bottom:10px;"></div>
  <table id="printTable">
    <thead>
      <tr>
        <th>Date</th><th>Class</th><th>Subject</th><th>Period</th>
        <th>Topic Taught</th><th>Home Assignment</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- POPUP FOR DATE SELECTION -->
<div id="datePopup">
  <div class="box">
    <h3>Select Date</h3>
    <input type="date" id="popupDate" style="width:100%;padding:8px;margin-top:10px;">
    <div style="text-align:right;margin-top:10px;">
      <button onclick="closePopup()">Cancel</button>
      <button onclick="confirmDate()" style="background:#004aad;color:#fff;">OK</button>
    </div>
  </div>
</div>

<script>
let diary = JSON.parse(localStorage.getItem("teacher_diary") || "[]");

// Load table on page load
function loadTable(){
  const tb = document.querySelector("#diaryTable tbody");
  tb.innerHTML = "";
  diary.forEach(row=>{
    tb.innerHTML += `<tr>
      <td>${row.date}</td>
      <td>${row.classSel}</td>
      <td>${row.subject}</td>
      <td>${row.period}</td>
      <td>${row.topic}</td>
      <td>${row.home}</td>
    </tr>`;
  });
}
loadTable();

// SAVE ENTRY
document.getElementById("saveBtn").onclick = () => {
  const entry = {
    tname: tname.value,
    tdesign: tdesign.value,
    tschool: tschool.value,
    date: date.value,
    classSel: classSel.value,
    subject: subject.value,
    period: period.value,
    topic: topic.value,
    home: home.value
  };

  if(!entry.date || !entry.classSel || !entry.subject){
    alert("Please fill date, class, subject.");
    return;
  }

  diary.push(entry);
  localStorage.setItem("teacher_diary", JSON.stringify(diary));
  loadTable();
  alert("Saved Successfully!");
};

// Popup Handlers
let actionType = "";
let selectedPrintDate = "";

function openPopup(type){
  actionType = type;
  document.getElementById("popupDate").value = "";
  document.getElementById("datePopup").style.display = "flex";
}

function closePopup(){
  document.getElementById("datePopup").style.display = "none";
}

function confirmDate(){
  let d = document.getElementById("popupDate").value;
  if(!d){ alert("Please select a date."); return; }
  selectedPrintDate = d;
  closePopup();
  if(actionType === "print") runPrint(d);
  if(actionType === "pdf") runPDF(d);
}

// Build Print Table
function buildPrintArea(filtered){
  document.querySelector("#printTeacherInfo").innerHTML =
   `Teacher: ${tname.value} | Designation: ${tdesign.value} | School: ${tschool.value}`;

  const pt = document.querySelector("#printTable tbody");
  pt.innerHTML = "";
  filtered.forEach(row=>{
    pt.innerHTML += `<tr>
      <td>${row.date}</td>
      <td>${row.classSel}</td>
      <td>${row.subject}</td>
      <td>${row.period}</td>
      <td>${row.topic}</td>
      <td>${row.home}</td>
    </tr>`;
  });
}

// PRINT BUTTON
document.getElementById("printBtn").onclick = ()=>{
  openPopup("print");
};

function runPrint(d){
  const filtered = diary.filter(x => x.date === d);

  if(filtered.length === 0){
    alert("No record found for this date.");
    return;
  }

  buildPrintArea(filtered);

  const win = window.open("", "_blank");
  win.document.write(`
<html><head><title>Teacher Diary</title>
<style>
table{width:100%;border-collapse:collapse;font-family:Arial;}
th,td{border:1px solid #ccc;padding:6px;text-align:center;}
th{background:#ffeeb3;}
</style>
</head><body>
${document.getElementById("printArea").innerHTML}
</body></html>
  `);

  win.document.close();
  setTimeout(()=>{ win.print(); win.close(); }, 500);
}

// PDF DOWNLOAD
document.getElementById("pdfBtn").onclick = ()=>{
  openPopup("pdf");
};

async function runPDF(d){
  const filtered = diary.filter(x => x.date === d);

  if(filtered.length === 0){
    alert("No record found for this date.");
    return;
  }

  buildPrintArea(filtered);

  const area = document.getElementById("printArea");
  area.style.display = "block";

  await new Promise(res=>setTimeout(res,200));
  const canvas = await html2canvas(area, {scale:2});
  const img = canvas.toDataURL("image/png");

  const { jsPDF } = window.jspdf;

  const pdf = new jsPDF({
    orientation: 'landscape',
    unit: 'px',
    format: [canvas.width, canvas.height]
  });

  pdf.addImage(img, "PNG", 0, 0, canvas.width, canvas.height);
  pdf.save(`TeacherDiary_${d}.pdf`);

  area.style.display = "none";
}
</script>

</body>
</html>
